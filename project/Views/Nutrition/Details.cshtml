@model proje.Models.NutritionPlan
@{
    ViewData["Title"] = "Beslenme Programƒ± Detaylarƒ±";
    Layout = "_Layout";
}

@functions {
    (List<(string Name, string Content, string Time)> Meals, string GeneralInfo) ParseNutritionPlan(string planDetails)
    {
        var meals = new List<(string Name, string Content, string Time)>();
        var generalInfo = new List<string>();
        
        if (string.IsNullOrEmpty(planDetails))
            return (meals, "");
        
        var mealKeywords = new[] { 
            "Kahvaltƒ±", "Sabah", "Breakfast", "Morning",
            "√ñƒüle", "√ñƒüle Yemeƒüi", "Lunch", "√ñƒülen",
            "Ak≈üam", "Ak≈üam Yemeƒüi", "Dinner", "Evening",
            "Ara √ñƒü√ºn", "Snack", "Atƒ±≈ütƒ±rmalƒ±k", "ƒ∞kindi"
        };
        
        var generalInfoKeywords = new[] {
            "Porsiyon Miktarlarƒ±", "Portion", "Tarif", "Recipe", "Makro Besin",
            "√ñnemli Notlar", "Important Notes", "Dikkat Edilmesi Gerekenler",
            "√ñneriler", "Recommendations", "Programƒ± Takip",
            "Ki≈üiselle≈ütirilmi≈ü", "Ad Soyad", "Ya≈ü", "Cinsiyet", "Boy", "Kilo",
            "Hedef", "Aktivite Seviyesi"
        };
        
        bool foundMealPlanSection = false; 
        
        var lines = planDetails.Split(new[] { "\n", "\r\n" }, StringSplitOptions.None);
        var currentMeal = "";
        var currentTime = "";
        var currentContent = new List<string>();
        bool inMealSection = false;
        bool inGeneralSection = false;
        var currentGeneralSection = new List<string>();
        
        foreach (var line in lines)
        {
            var trimmedLine = line.Trim();
            var originalLine = trimmedLine;
            
            if (trimmedLine.StartsWith("####") || trimmedLine.StartsWith("###") || 
                trimmedLine.StartsWith("##") || trimmedLine.StartsWith("#"))
            {
                trimmedLine = trimmedLine.TrimStart('#', ' ').Trim();
            }
            
            if (string.IsNullOrEmpty(trimmedLine))
            {
                if (inMealSection && currentContent.Any())
                {
                    currentContent.Add("<br>");
                }
                else if (inGeneralSection && currentGeneralSection.Any())
                {
                    currentGeneralSection.Add("<br>");
                }
                continue;
            }
            
            if (trimmedLine.Contains("G√ºnl√ºk √ñƒü√ºn Planƒ±", StringComparison.OrdinalIgnoreCase) ||
                trimmedLine.Contains("Daily Meal Plan", StringComparison.OrdinalIgnoreCase))
            {
                foundMealPlanSection = true;
                continue;
            }
            
            bool isGeneralInfo = false;
            if (!foundMealPlanSection || trimmedLine.StartsWith("2.") || trimmedLine.StartsWith("3.") || 
                trimmedLine.StartsWith("4.") || trimmedLine.StartsWith("5.") || trimmedLine.StartsWith("6.") ||
                trimmedLine.StartsWith("### 2") || trimmedLine.StartsWith("### 3") || 
                trimmedLine.StartsWith("### 4") || trimmedLine.StartsWith("### 5") || trimmedLine.StartsWith("### 6"))
            {
                foreach (var keyword in generalInfoKeywords)
                {
                    if (trimmedLine.Contains(keyword, StringComparison.OrdinalIgnoreCase) && 
                        !trimmedLine.Contains("Kahvaltƒ±") && !trimmedLine.Contains("√ñƒüle") && 
                        !trimmedLine.Contains("Ak≈üam") && !trimmedLine.Contains("Ara √ñƒü√ºn"))
                    {
                        isGeneralInfo = true;
                        break;
                    }
                }
            }
            
            if (inMealSection && isGeneralInfo)
            {
                if (!string.IsNullOrEmpty(currentMeal) && currentContent.Any())
                {
                    var content = string.Join("", currentContent).Trim();
                    if (!string.IsNullOrEmpty(content))
                    {
                        meals.Add((currentMeal, content, currentTime));
                    }
                }
                currentMeal = "";
                currentContent.Clear();
                inMealSection = false;
            }
            
            bool isNightMeal = false;
            if (trimmedLine.Contains("Gece", StringComparison.OrdinalIgnoreCase) || 
                trimmedLine.Contains("Yatmadan", StringComparison.OrdinalIgnoreCase) || 
                trimmedLine.Contains("Before Bed", StringComparison.OrdinalIgnoreCase) ||
                trimmedLine.Contains("Gece Atƒ±≈ütƒ±rmalƒ±ƒüƒ±", StringComparison.OrdinalIgnoreCase))
            {
                isNightMeal = true;
            }
            
            bool isMealHeader = false;
            string mealName = "";
            string mealTime = "";
            
            if (!isNightMeal && !isGeneralInfo)
            {
                foreach (var keyword in mealKeywords)
                {
                    if (trimmedLine.Contains(keyword, StringComparison.OrdinalIgnoreCase))
                    {
                        isMealHeader = true;
                        
                        if (keyword.Contains("Kahvaltƒ±") || keyword.Contains("Sabah") || keyword.Contains("Breakfast") || keyword.Contains("Morning"))
                            mealName = "Kahvaltƒ±";
                        else if (keyword.Contains("√ñƒüle") || keyword.Contains("Lunch") || keyword.Contains("√ñƒülen"))
                            mealName = "√ñƒüle Yemeƒüi";
                        else if (keyword.Contains("Ak≈üam") || keyword.Contains("Dinner") || keyword.Contains("Evening"))
                            mealName = "Ak≈üam Yemeƒüi";
                        else if (keyword.Contains("Ara") || keyword.Contains("Snack") || keyword.Contains("Atƒ±≈ütƒ±rmalƒ±k") || keyword.Contains("ƒ∞kindi"))
                            mealName = "Ara √ñƒü√ºn";
                        else
                            mealName = keyword;
                        
                        var timeMatch = System.Text.RegularExpressions.Regex.Match(trimmedLine, @"\((\d{1,2}:\d{2})\)");
                        if (timeMatch.Success)
                        {
                            mealTime = timeMatch.Groups[1].Value;
                        }
                        
                        break;
                    }
                }
            }
            
            if (isGeneralInfo || isNightMeal)
            {
                if (!string.IsNullOrEmpty(currentMeal) && currentContent.Any())
                {
                    var content = string.Join("", currentContent).Trim();
                    if (!string.IsNullOrEmpty(content))
                    {
                        meals.Add((currentMeal, content, currentTime));
                    }
                }
                currentMeal = "";
                currentContent.Clear();
                inMealSection = false;
                inGeneralSection = true;
                var processedLine = ProcessMarkdownLine(originalLine);
                currentGeneralSection.Add(processedLine);
            }
            else if (isMealHeader)
            {
                if (!string.IsNullOrEmpty(currentMeal) && currentContent.Any())
                {
                    var content = string.Join("", currentContent).Trim();
                    if (!string.IsNullOrEmpty(content))
                    {
                        meals.Add((currentMeal, content, currentTime));
                    }
                }
                currentMeal = mealName;
                currentTime = mealTime;
                currentContent.Clear();
                inMealSection = true;
                inGeneralSection = false;
            }
            else if (inMealSection)
            {
                bool isGeneralInMeal = false;
                
                foreach (var keyword in generalInfoKeywords)
                {
                    if (trimmedLine.Contains(keyword, StringComparison.OrdinalIgnoreCase) && 
                        (trimmedLine.StartsWith("2.") || trimmedLine.StartsWith("3.") || 
                         trimmedLine.StartsWith("4.") || trimmedLine.StartsWith("5.") || 
                         trimmedLine.StartsWith("6.") || trimmedLine.StartsWith("###")))
                    {
                        isGeneralInMeal = true;
                        break;
                    }
                }
                
                bool isFoodItem = trimmedLine.StartsWith("-") || trimmedLine.StartsWith("*");
                
                if (!isFoodItem)
                {
                    bool hasQuantity = trimmedLine.Contains("gram") || trimmedLine.Contains("porsiyon") ||
                                      trimmedLine.Contains("su bardaƒüƒ±") || trimmedLine.Contains("tatlƒ± ka≈üƒ±ƒüƒ±") ||
                                      trimmedLine.Contains("ka≈üƒ±k") || trimmedLine.Contains("dilim") ||
                                      trimmedLine.Contains("adet") || trimmedLine.Contains("k√¢se");
                    
                    bool hasFoodName = trimmedLine.Contains("yumurta") || trimmedLine.Contains("ekmek") ||
                                      trimmedLine.Contains("tavuk") || trimmedLine.Contains("sebze") ||
                                      trimmedLine.Contains("meyve") || trimmedLine.Contains("yoƒüurt") ||
                                      trimmedLine.Contains("pilav") || trimmedLine.Contains("salata") ||
                                      trimmedLine.Contains("badem") || trimmedLine.Contains("muz") ||
                                      trimmedLine.Contains("elma") || trimmedLine.Contains("armut") ||
                                      trimmedLine.Contains("brokoli") || trimmedLine.Contains("karnabahar") ||
                                      trimmedLine.Contains("enginar") || trimmedLine.Contains("kabak") ||
                                      trimmedLine.Contains("ƒ±zgara") || trimmedLine.Contains("ha≈ülanmƒ±≈ü") ||
                                      trimmedLine.Contains("zeytinyaƒülƒ±") || trimmedLine.Contains("bulgur") ||
                                      trimmedLine.Contains("kinoa") || trimmedLine.Contains("yulaf") ||
                                      trimmedLine.Contains("havu√ß") || trimmedLine.Contains("marin") ||
                                      trimmedLine.Contains("baharat") || trimmedLine.Contains("limon");
                    
                    isFoodItem = hasQuantity && hasFoodName;
                }
                
                var generalPhrases = new[] {
                    "Bu program", "hedeflerinize ula≈ümanƒ±zda", "doktora veya diyetisyene danƒ±≈ümanƒ±z",
                    "Ba≈üarƒ±lar dilerim", "saƒülƒ±ƒüƒ±nƒ±zƒ± dikkate almayƒ±", "herhangi bir saƒülƒ±k sorununuz",
                    "√ñƒü√ºnlerde √ñnerilen", "Porsiyon Miktarlarƒ±", "T√ºrk Mutfaƒüƒ±na Uygun",
                    "Makro Besin Daƒüƒ±lƒ±mƒ±", "√ñnemli Notlar", "Dikkat Edilmesi Gerekenler",
                    "√∂zen g√∂sterin", "yaparak", "yapmaya", "uzak durun", "tercih edin", "deneyin",
                    "sƒ±kƒ±lmazsƒ±nƒ±z", "artƒ±rƒ±n", "ayarlayƒ±n", "koruyun",
                    "egzersiz", "spor", "y√ºr√ºy√º≈ü", "aktif", "metabolizma", "hƒ±zlandƒ±racaktƒ±r",
                    "atlamayƒ±n", "√ße≈üitli", "taze", "mevsiminde", "abur cubur", "i≈ülenmi≈ü",
                    "psikolojik", "motivasyon", "destek", "danƒ±≈ümanƒ±z", "√∂nemlidir"
                };
                
                bool isWaterNote = trimmedLine.Contains("su", StringComparison.OrdinalIgnoreCase) && 
                                   (trimmedLine.Contains("t√ºketim") || trimmedLine.Contains("i√ßmek") || 
                                    trimmedLine.Contains("dikkat") || trimmedLine.Contains("miktar")) &&
                                   trimmedLine.Length < 100; 

                if (!isFoodItem && !isWaterNote)
                {
                    foreach (var phrase in generalPhrases)
                    {
                        if (trimmedLine.Contains(phrase, StringComparison.OrdinalIgnoreCase))
                        {
                            isGeneralInMeal = true;
                            break;
                        }
                    }
                    
                    if (!isGeneralInMeal && trimmedLine.Length > 80 && 
                        !trimmedLine.Contains(":") && !trimmedLine.Contains("(") &&
                        !trimmedLine.Contains("gram") && !trimmedLine.Contains("porsiyon") &&
                        !trimmedLine.StartsWith("-") && !trimmedLine.StartsWith("*"))
                    {
                        isGeneralInMeal = true;
                    }
                }
                
                if (isGeneralInMeal)
                {
                    if (!string.IsNullOrEmpty(currentMeal) && currentContent.Any())
                    {
                        var content = string.Join("", currentContent).Trim();
                        if (!string.IsNullOrEmpty(content))
                        {
                            meals.Add((currentMeal, content, currentTime));
                        }
                    }
                    currentMeal = "";
                    currentContent.Clear();
                    inMealSection = false;
                    inGeneralSection = true;
                    var processedLine = ProcessMarkdownLine(originalLine);
                    currentGeneralSection.Add(processedLine);
                }
                else
                {
                    var processedLine = ProcessMarkdownLine(trimmedLine);
                    currentContent.Add(processedLine);
                }
            }
            else if (inGeneralSection)
            {
                var processedLine = ProcessMarkdownLine(trimmedLine);
                currentGeneralSection.Add(processedLine);
            }
        }
        
        if (!string.IsNullOrEmpty(currentMeal) && currentContent.Any())
        {
            var content = string.Join("", currentContent).Trim();
            if (!string.IsNullOrEmpty(content))
            {
                meals.Add((currentMeal, content, currentTime));
            }
        }

        var generalInfoText = string.Join("", currentGeneralSection).Trim();
        
        return (meals, generalInfoText);
    }
    
    string ProcessMarkdownLine(string line)
    {
        if (string.IsNullOrEmpty(line))
            return "<br>";
        
        line = System.Text.RegularExpressions.Regex.Replace(line, @"\*\*(.+?)\*\*", "<strong>$1</strong>");
        
        if (line.StartsWith("- ") || line.StartsWith("* "))
        {
            line = line.Substring(2);
            return "<div class='meal-item'><i class='bi bi-check-circle-fill text-success me-2'></i>" + line + "</div>";
        }

        var numberedMatch = System.Text.RegularExpressions.Regex.Match(line, @"^\d+\.\s+(.+)$");
        if (numberedMatch.Success)
        {
            return "<div class='meal-item'><span class='meal-number'>" + numberedMatch.Groups[0].Value.Split('.')[0] + ".</span> " + numberedMatch.Groups[1].Value + "</div>";
        }
        
        return "<div class='meal-item'>" + line + "</div>";
    }
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">üçΩÔ∏è Beslenme Programƒ± Detaylarƒ±</h3>
                    <small>Olu≈üturulma Tarihi: @Model.CreatedDate.ToString("dd.MM.yyyy HH:mm")</small>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h5>üìã Program Bilgileri</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th>Hedef:</th>
                                    <td>@(Model.Goal ?? "Belirtilmemi≈ü")</td>
                                </tr>
                                <tr>
                                    <th>Aktivite Seviyesi:</th>
                                    <td>@(Model.ActivityLevel ?? "Belirtilmemi≈ü")</td>
                                </tr>
                                @if (Model.DailyCalorieTarget.HasValue)
                                {
                                    <tr>
                                        <th>G√ºnl√ºk Kalori Hedefi:</th>
                                        <td><strong>@Model.DailyCalorieTarget.Value.ToString("F0") kcal</strong></td>
                                    </tr>
                                }
                                @if (Model.DailyProtein.HasValue)
                                {
                                    <tr>
                                        <th>G√ºnl√ºk Protein:</th>
                                        <td>@Model.DailyProtein.Value.ToString("F1") g</td>
                                    </tr>
                                }
                                @if (Model.DailyCarbohydrate.HasValue)
                                {
                                    <tr>
                                        <th>G√ºnl√ºk Karbonhidrat:</th>
                                        <td>@Model.DailyCarbohydrate.Value.ToString("F1") g</td>
                                    </tr>
                                }
                                @if (Model.DailyFat.HasValue)
                                {
                                    <tr>
                                        <th>G√ºnl√ºk Yaƒü:</th>
                                        <td>@Model.DailyFat.Value.ToString("F1") g</td>
                                    </tr>
                                }
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5>‚ö†Ô∏è √ñzel Bilgiler</h5>
                            @if (!string.IsNullOrEmpty(Model.Allergies))
                            {
                                <div class="alert alert-warning">
                                    <strong>Alerjiler:</strong> @Model.Allergies
                                </div>
                            }
                            @if (!string.IsNullOrEmpty(Model.DislikedFoods))
                            {
                                <div class="alert alert-info">
                                    <strong>Sevilmeyen Gƒ±dalar:</strong> @Model.DislikedFoods
                                </div>
                            }
                            @if (!string.IsNullOrEmpty(Model.SpecialNotes))
                            {
                                <div class="alert alert-secondary">
                                    <strong>√ñzel Notlar:</strong> @Model.SpecialNotes
                                </div>
                            }
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5>üìù Detaylƒ± Beslenme Programƒ±</h5>
                        @if (!string.IsNullOrEmpty(Model.PlanDetails))
                        {
                            var result = ParseNutritionPlan(Model.PlanDetails);
                            var meals = result.Meals;
                            var generalInfo = result.GeneralInfo;
                            
                            // Genel bilgileri en √ºste g√∂ster
                            @if (!string.IsNullOrEmpty(generalInfo))
                            {
                                <div class="card mb-4 general-info-card shadow-sm">
                                    <div class="card-header general-info-header">
                                        <h5 class="mb-0">‚ÑπÔ∏è Genel Bilgiler ve √ñneriler</h5>
                                    </div>
                                    <div class="card-body general-info-body">
                                        <div class="general-info-content">
                                            @Html.Raw(generalInfo)
                                        </div>
                                    </div>
                                </div>
                            }
                            
                            @if (meals.Any())
                            {
                                var mealOrder = new Dictionary<string, int>
                                {
                                    { "Kahvaltƒ±", 1 },
                                    { "Ara √ñƒü√ºn", 2 },
                                    { "√ñƒüle Yemeƒüi", 3 },
                                    { "Ak≈üam Yemeƒüi", 4 }
                                };
                                
                                var processedMeals = new List<(string Name, string Content, string Time)>();
                                
                                var nonSnackMeals = meals
                                    .Where(m => mealOrder.ContainsKey(m.Name) && m.Name != "Ara √ñƒü√ºn")
                                    .GroupBy(m => m.Name)
                                    .Select(g => g.OrderBy(m => m.Time ?? "").First())
                                    .ToList();

                                var snackMeals = meals
                                    .Where(m => m.Name == "Ara √ñƒü√ºn")
                                    .OrderBy(m => m.Time ?? "")
                                    .ToList();
                                
                                var allMeals = nonSnackMeals.Concat(snackMeals).ToList();
                                
                                var orderedMeals = new List<(string Name, string Content, string Time)>();
                                
                                var breakfast = allMeals.FirstOrDefault(m => m.Name == "Kahvaltƒ±");
                                if (!string.IsNullOrEmpty(breakfast.Name)) orderedMeals.Add(breakfast);
                                
                                var lunchMeal = allMeals.FirstOrDefault(m => m.Name == "√ñƒüle Yemeƒüi");
                                var lunchTime = lunchMeal.Time ?? "";
                                var firstSnacks = snackMeals.Where(s => {
                                    var snackTime = s.Time ?? "";
                                    return string.IsNullOrEmpty(lunchTime) || string.Compare(snackTime, lunchTime) < 0;
                                }).ToList();
                                orderedMeals.AddRange(firstSnacks);
                                
                                if (!string.IsNullOrEmpty(lunchMeal.Name)) orderedMeals.Add(lunchMeal);
                                
                                var dinnerMeal = allMeals.FirstOrDefault(m => m.Name == "Ak≈üam Yemeƒüi");
                                var dinnerTime = dinnerMeal.Time ?? "";
                                var secondSnacks = snackMeals.Where(s => {
                                    var snackTime = s.Time ?? "";
                                    bool afterLunch = string.IsNullOrEmpty(lunchTime) || string.Compare(snackTime, lunchTime) > 0;
                                    bool beforeDinner = string.IsNullOrEmpty(dinnerTime) || string.Compare(snackTime, dinnerTime) < 0;
                                    return afterLunch && beforeDinner;
                                }).ToList();
                                orderedMeals.AddRange(secondSnacks);
                                
                                if (!string.IsNullOrEmpty(dinnerMeal.Name)) orderedMeals.Add(dinnerMeal);
                                
                                @foreach (var meal in orderedMeals)
                                {
                                    <div class="card mb-4 meal-card shadow-sm">
                                        <div class="card-header meal-header">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <h5 class="mb-0">
                                                    @switch (meal.Name)
                                                    {
                                                        case "Kahvaltƒ±":
                                                            <span>üåÖ @meal.Name</span>
                                                            break;
                                                        case "Ara √ñƒü√ºn":
                                                            <span>üçé @meal.Name</span>
                                                            break;
                                                        case "√ñƒüle Yemeƒüi":
                                                            <span>‚òÄÔ∏è @meal.Name</span>
                                                            break;
                                                        case "Ak≈üam Yemeƒüi":
                                                            <span>üåô @meal.Name</span>
                                                            break;
                                                        default:
                                                            <span>üçΩÔ∏è @meal.Name</span>
                                                            break;
                                                    }
                                                </h5>
                                                @if (!string.IsNullOrEmpty(meal.Time))
                                                {
                                                    <span class="meal-time badge bg-light text-dark">
                                                        <i class="bi bi-clock"></i> @meal.Time
                                                    </span>
                                                }
                                            </div>
                                        </div>
                                        <div class="card-body meal-body">
                                            <div class="meal-content-wrapper">
                                                @Html.Raw(meal.Content)
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                            else if (string.IsNullOrEmpty(generalInfo))
                            {
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <div style="white-space: pre-wrap; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.8;">
                                            @Html.Raw(Model.PlanDetails?.Replace("\n", "<br>"))
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <div class="card bg-light">
                                <div class="card-body">
                                    <p class="text-muted">Hen√ºz detaylƒ± beslenme programƒ± eklenmemi≈ü.</p>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="mt-4">
                        <a href="@Url.Action("MyPlans", "Nutrition")" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Programlarƒ±m
                        </a>
                        <a href="@Url.Action("Create", "Nutrition")" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Yeni Program Olu≈ütur
                        </a>
                        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                            <i class="bi bi-trash"></i> Programƒ± Sil
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Silme Onay Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content cancel-confirm-modal">
            <div class="modal-body">
                <div class="cancel-confirm-icon">
                    <i class="bi bi-exclamation-triangle"></i>
                </div>
                <h5 class="cancel-confirm-title">Beslenme Programƒ±nƒ± Silmek ƒ∞stediƒüinizden Emin misiniz?</h5>
                <p class="cancel-confirm-message">Bu i≈ülem geri alƒ±namaz. Beslenme programƒ± ve t√ºm bilgiler kalƒ±cƒ± olarak silinecektir.</p>
                <div class="gym-delete-info">
                    <div class="info-item-delete">
                        <strong>Program:</strong> @(Model.Goal ?? "Beslenme Programƒ±")
                    </div>
                    <div class="info-item-delete">
                        <strong>Olu≈üturulma:</strong> @Model.CreatedDate.ToString("dd.MM.yyyy HH:mm")
                    </div>
                    @if (Model.DailyCalorieTarget.HasValue)
                    {
                        <div class="info-item-delete">
                            <strong>Kalori Hedefi:</strong> @Model.DailyCalorieTarget.Value.ToString("F0") kcal
                        </div>
                    }
                </div>
                <div class="cancel-confirm-actions">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Vazge√ß</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn" data-plan-id="@Model.Id">Evet, Sil</button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        border-radius: 12px;
    }
    .card-header {
        border-radius: 12px 12px 0 0 !important;
    }
    table th {
        background-color: #f8f9fa;
        width: 40%;
    }
    
    .meal-card {
        border: none;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    .meal-card:hover {
        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        transform: translateY(-2px);
    }
    
    .meal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-bottom: none;
        padding: 1.25rem 1.5rem;
    }
    
    .meal-header h5 {
        color: white;
        font-weight: 600;
        margin: 0;
        font-size: 1.25rem;
    }
    
    .meal-time {
        font-size: 0.9rem;
        padding: 0.5rem 0.75rem;
        border-radius: 20px;
    }
    
    .meal-body {
        padding: 1.5rem;
        background-color: #ffffff;
    }
    
    .meal-content-wrapper {
        line-height: 1.8;
        font-size: 1rem;
        color: #333;
    }
    
    .meal-item {
        padding: 0.75rem 0;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        align-items: flex-start;
    }
    
    .meal-item:last-child {
        border-bottom: none;
    }
    
    .meal-item i {
        margin-top: 0.25rem;
        flex-shrink: 0;
    }
    
    .meal-item .meal-number {
        font-weight: 600;
        color: #667eea;
        margin-right: 0.5rem;
    }
    
    .meal-content-wrapper strong {
        color: #667eea;
        font-weight: 600;
    }
    
    .meal-content-wrapper br {
        line-height: 1.5;
    }
    
    .general-info-card {
        border: 1px solid #dee2e6;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .general-info-header {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        border-bottom: none;
        padding: 1.25rem 1.5rem;
    }
    
    .general-info-header h5 {
        color: white;
        font-weight: 600;
        margin: 0;
        font-size: 1.25rem;
    }
    
    .general-info-body {
        padding: 1.5rem;
        background-color: #ffffff;
    }
    
    .general-info-content {
        line-height: 1.8;
        font-size: 1rem;
        color: #333;
    }
    
    .general-info-content .meal-item {
        padding: 0.5rem 0;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .general-info-content .meal-item:last-child {
        border-bottom: none;
    }

    /* Silme Onay Modal Stilleri */
    .cancel-confirm-modal {
        border: none;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        overflow: hidden;
    }

    .cancel-confirm-modal .modal-body {
        padding: 2rem;
        text-align: center;
    }

    .cancel-confirm-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: pulse 2s infinite;
    }

    .cancel-confirm-icon i {
        font-size: 2.5rem;
        color: #dc2626;
    }

    @@keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }

    .cancel-confirm-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 1rem;
    }

    .cancel-confirm-message {
        color: #64748b;
        font-size: 1rem;
        margin-bottom: 1.5rem;
        line-height: 1.6;
    }

    .gym-delete-info {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 1.5rem;
        margin: 1.5rem 0 2rem;
        border: 1px solid rgba(226, 232, 240, 0.8);
        text-align: left;
    }

    .info-item-delete {
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(226, 232, 240, 0.6);
        color: #1e293b;
    }

    .info-item-delete:last-child {
        border-bottom: none;
    }

    .info-item-delete strong {
        color: #64748b;
        margin-right: 0.5rem;
        font-weight: 600;
    }

    .cancel-confirm-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
    }

    .cancel-confirm-actions .btn {
        padding: 0.75rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .cancel-confirm-actions .btn-secondary {
        background: #f1f5f9;
        border: 1px solid #e2e8f0;
        color: #64748b;
    }

    .cancel-confirm-actions .btn-secondary:hover {
        background: #e2e8f0;
        transform: translateY(-2px);
    }

    .cancel-confirm-actions .btn-danger {
        background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        border: none;
        color: white;
    }

    .cancel-confirm-actions .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
            const planId = this.getAttribute('data-plan-id');
            
            if (!planId) {
                alert('Program ID bulunamadƒ±.');
                return;
            }

            const token = document.querySelector('input[name="__RequestVerificationToken"]')?.value;
            
            if (!token) {
                alert('G√ºvenlik token\'ƒ± bulunamadƒ±. Sayfayƒ± yenileyip tekrar deneyin.');
                return;
            }

            fetch('@Url.Action("Delete", "Nutrition")', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'RequestVerificationToken': token
                },
                body: new URLSearchParams({
                    id: planId,
                    __RequestVerificationToken: token
                })
            })
            .then(response => response.json())
            .then(data => {
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
                modal.hide();
                
                if (data.success) {
                    // Ba≈üarƒ± mesajƒ± g√∂ster ve MyPlans sayfasƒ±na y√∂nlendir
                    window.location.href = '@Url.Action("MyPlans", "Nutrition")';
                } else {
                    alert(data.message || 'Beslenme programƒ± silinirken bir hata olu≈ütu.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Bir hata olu≈ütu. L√ºtfen tekrar deneyin.');
            });
        });
    });
</script>

